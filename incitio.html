<!DOCTYPE html>
<html lang="en">
<!--   

Task list
=========

Impliment explode
Improve the alert system
Produce a good sample - pick a style and make a house etc
Change the sample data to be file based.

Timebox the work
Spend all day looking busy , anyway, that's not so bad is it? But need to make use of my
time allowance on the software.

Learn git hub, can sneak in youtube vidoes

Install ssh no password login to improve workflow to dreamhost ( no tegngas mierdo )

Keep up exercise.

Use wiki for test images!


Make local storage to proivide for offline working


Incityo - 8/11/24
 
- on hover over image show name etc ( done )

- maybe show breadcrumbs { done }

- new parent list should be sorted in alpha order

- Error condition for go user and create user ( User.exists ) Now changed modus...

- BUG: on deleting an item focus is undefined so if you delete again you get an eror.(done)

- revisit let gChainArray = []; 
 version , left behind

- Bottom out the exif issue - Resolved 12/10/24 ( done )
 
- large circle type tree thing - figured out how, will do later

- Need to look at Cordova
- Start with npm
- Look at how it works with javascript

- Recode and polish existing codebase ( doing )

- When delete an item, delete the photo from disk also
 

A lot of no image, but also broken links
https://gomakethings.com/handling-missing-images-with-vanilla-js/
 
 

make good demos

Delete container ask what happens to children. ( sort of )

Prevent change container for home , id 0

 Shortcut keys. Pending. Low priority.

  Android version.Low priority atm . Maybe javascript to start with. Priority 10.

  Image rotation ( not needed )

  Trash can.

 Better track of thumbnails to remove unwanted ones.

 May need to $POST in which case

 https://www.w3schools.com/php/php_superglobals_post.asp


how to change stylesheets on the fly!!!
https://stackoverflow.com/questions/19844545/replacing-css-file-on-the-fly-and-apply-the-new-style-to-the-page


-->



<head>
  <meta charset="UTF-8">
  <title>Incitio</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>



  <link id="theCss" rel="stylesheet" href="./incitio.css">
  <script>
    // alert(screen.width);
    if (screen.width < 500) {
      theCss.href = "./mincitio.css";
    }
  </script>


</head>

<script src="./incitio.js"></script>

<script src="./lib/buttons.js"></script>
<script src="./lib/backend.js"></script>

<script>

  // Long touch

  /*

  let onlongtouch = false;
  let timer = false;
  let duration = 800;
  let touched = false;

  function touchStart(evt) {
    if (!timer) {
      timer = setTimeout(onlongtouch, duration);
      touched = evt.target;
    }
  }

  function touchEnd() {
    if (timer) {
      clearTimeout(timer)
      timer = false;
    }
  }


  onlongtouch = function () {
    //  touched.innerHTML = touched.id;

    let buttonId = touched.id;

    let id = buttonId.split("_");

    xsetCurrentRoot(id[1]);


    timer = false;
    duration = 800;
    touched = false;

  }

  */

  async function readText(event) {
    const file = event.target.files.item(0)
    const text = await file.text();

    //  document.getElementById("output").innerText = text
    //alert(text);
    let js = text;
    gItemArray = JSON.parse(js);

    paintBreadCrumbs(0);
    Alert.show("done get upload");

    chain_0.click();


  }

  function mobile() {
    return screen.width < 500;
  }



</script>

<body>


  <button id="alertBox" class="alert" onClick="alertBox.style.display='none';">
    <p id="alertText" class="center">some text</p>
  </button>






  <div id="topDiv" class="myDiv topDiv">




    <div id="panelIntro" class="myDiv col1">
      <div>
        <div style="margin:auto">
          <!--   New + not used -->
          <button class="btn btn-primary" onclick="if(mobile()) hid(panelIntro)" type="button" id="dropdownMenuButton"
            style="border-style: none;  margin-top: 10px;border-radius: 16px; ">
            <h1>+New</h1>
          </button>
        </div>
        <p></p>
        <div class="myDiv">
          <p style="padding:10px">
            A user reference has been created for you.
            This should mean that the program will preserve
            any changes to the data in a multi user environment.
            You may want to take a note of the reference number.
          </p>
        </div>


        <div id="panelData">
          <br>
          <div class="myDiv" style="margin-top:20px;background-color: #6f8670;padding:10px">
            <h4>Data</h4>
            <button class="btn btn-info btn-sm" style="width:70%;margin:3px" onclick="loadTestData()">Load Test
              Data</button>

            <button class="btn btn-dark btn-sm" style="width:70%;margin:3px" onclick="up.click();showAllItems();">Upload
              Data</button>
            <div style="display:none">
              <input type="file" id="up" onchange="readText(event)" />
              <pre id="output"></pre>
            </div>

            <a id='a' download='JSONDownload.txt' type='text/txt'></a>
            <button class="btn btn-primary btn-sm" style="width:70%;margin:3px" onclick=" 
              const d = new Date();
              let text = d.toLocaleDateString() + ` ` + d.toLocaleTimeString();
              a.download='IncitioDownload '  +  text + '.txt';          
              downloadData()">Download Data</button>

            <button onclick="localStorage.clear();alert('cleared storage')">clear storage</button>

          </div>
        </div>



      </div>
    </div>

    <!-- second column -->
    <div class="myDiv col2">
      <div style="background-color: white;">
        <h1>
          <script>getVersion()</script>
          <button onclick="localStorage.clear();alert('cleared storage')">clear storage</button>
        </h1>
      </div>
      <!-- Search-->
      <div class="inDiv" style="padding:10px;margin:auto;text-align: center;">

        <button id="idUser"></button>

        <button id="none" class="btn btn-light" style="margin:10px; background-color:blanchedalmond;position:relative;
                width: 80%;height: 15%; border-radius: 16px; box-shadow: 5px 5px 5px gray;">
          <span class="btn-label" onclick="doSearch()"
            style="position:absolute;top:0px; left:10px; margin-bottom: 20px;">
            <i class="bi-search" style="font-size:30px"></i></span>

          <input aria-label="Search inCitio" autocomplete="off" placeholder="Search inCitio" value="" name=""
            type="text" id="search" style="padding: 0px;   float:right;
              width: 90%;  background-color: rgb(219, 192, 192);
               z-index: 6; left: 0px;" spellcheck="false" aria-haspopup="true" aria-live="off" aria-owns="gs_sbt50"
            onkeydown="  
                  handle(event)
                ">
        </button>

        <script>
          function handle(e) {
            if (e.keyCode === 13) {
              e.preventDefault(); // Ensure it is only this code that runs
              doSearch();
            }
            let v = search.value;
            if (v.length > 2)
              search.innerHTML = "";
            doSearch();
          }
        </script>
        <!-- where the search results get displayed -->
        <div id="divSearch">
        </div>

      </div>
      <!-- end search -->

      <!-- breadcrumbs -->
      <div id="divBreadCrumbs" class="inDiv">

        <div>

          <div id="theName" style="float:center">button1</div>


        </div>
        <!-- chain -->
        <div id="divChain" style="text-align:center">
        </div>

        <div>



          <div class="inDiv">
            <button onclick="makeNewItem('i')">
              <svg width="32px" height="32px" viewBox="0 0 1024.00 1024.00" class="icon" version="1.1"
                xmlns="http://www.w3.org/2000/svg" fill="#000000">
                <g id="SVGRepo_bgCarrier" stroke-width="0" />
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />
                <g id="SVGRepo_iconCarrier">
                  <path d="M512 512m-448 0a448 448 0 1 0 896 0 448 448 0 1 0-896 0Z" fill="#4CAF50" />
                  <path d="M448 298.666667h128v426.666666h-128z" fill="#FFFFFF" />
                  <path d="M298.666667 448h426.666666v128H298.666667z" fill="#FFFFFF" />
                </g>
              </svg>
            </button>

            <button onclick="makeNewItem('c')">
              <svg width="32px" height="32px" viewBox="0 0 1024 1024" class="icon" version="1.1"
                xmlns="http://www.w3.org/2000/svg" fill="#000000">
                <g id="SVGRepo_bgCarrier" stroke-width="0" />
                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" />
                <g id="SVGRepo_iconCarrier">
                  <path d="M512 512m-448 0a448 448 0 1 0 896 0 448 448 0 1 0-896 0Z" fill="#151bc6" />
                  <path d="M448 298.666667h128v426.666666h-128z" fill="#FFFFFF" />
                  <path d="M298.666667 448h426.666666v128H298.666667z" fill="#FFFFFF" />
                </g>
              </svg>
            </button>




            <svg fill="#000000" height="32px" width="32px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve">

              <g id="SVGRepo_bgCarrier" stroke-width="0"/>
              
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>
              
              <g id="SVGRepo_iconCarrier"> <g> <g> <path d="M490.667,149.333c11.797,0,21.333-9.557,21.333-21.333V21.333c0-2.773-0.555-5.547-1.643-8.149 c-2.155-5.227-6.315-9.387-11.541-11.541C496.213,0.576,493.44,0,490.667,0H384c-11.797,0-21.333,9.557-21.333,21.333 S372.203,42.667,384,42.667h55.168L314.731,167.104c-16.875-11.179-37.035-17.771-58.731-17.771s-41.856,6.592-58.731,17.771 L72.832,42.667H128c11.797,0,21.333-9.557,21.333-21.333S139.797,0,128,0H21.333c-2.773,0-5.547,0.576-8.149,1.643 C7.957,3.797,3.797,7.957,1.643,13.184C0.576,15.787,0,18.56,0,21.333V128c0,11.776,9.536,21.333,21.333,21.333 S42.666,139.776,42.666,128V72.832l124.437,124.437c-11.179,16.875-17.771,37.035-17.771,58.731s6.592,41.856,17.771,58.731 L42.667,439.168V384c0-11.776-9.536-21.333-21.333-21.333C9.536,362.667,0,372.224,0,384v106.667c0,2.773,0.576,5.547,1.643,8.149 c2.155,5.227,6.315,9.387,11.541,11.541c2.603,1.067,5.376,1.643,8.149,1.643H128c11.797,0,21.333-9.557,21.333-21.333 s-9.536-21.333-21.333-21.333H72.832l124.437-124.437c16.875,11.179,37.035,17.771,58.731,17.771s41.856-6.592,58.731-17.771 l124.437,124.437H384c-11.797,0-21.333,9.557-21.333,21.333S372.203,512,384,512h106.667c2.773,0,5.547-0.576,8.149-1.643 c5.227-2.155,9.387-6.315,11.541-11.541c1.088-2.603,1.643-5.376,1.643-8.149V384c0-11.776-9.536-21.333-21.333-21.333 s-21.333,9.557-21.333,21.333v55.168L344.896,314.731c11.179-16.853,17.771-37.035,17.771-58.731 c0-21.696-6.592-41.877-17.771-58.731L469.333,72.832V128C469.333,139.776,478.869,149.333,490.667,149.333z"/> </g> </g> </g>
              
              </svg>


            <button class="action-button" onclick="makeNewItem('i')"
              style="background-color: green;color:white">+item</button>
            <button class="action-button" onclick="makeNewItem('c')"
              style="background-color: blue;color:white">+container</button>
            <button class="action-button" id="openContainer" onclick="openItem()"
              style=" background-color: black;color:white">open</button>
            <button class="action-button" id="explodeContainer" onclick="doExplode(getCurrentParentId())"
              style=" background-color: white;color:black">show TOTAL content</button>
          </div>

          <div style="display:flex;padding:3px">
            <div style="text-align: center;background-color:grey;width:50%">
              <img id="theHoverPhoto" class="hover-bc-photo" src="./images/noimage.jpg">
            </div>


            <div class="inDiv">
              <div>
                this is sample text
              </div>
              <div style=" text-align:center;background-color:white ;margin-bottom: 2px;">
                <button style="margin-bottom: 10px;">Click me</button>
              </div>
            </div>


          </div>


        </div>

        <!--    Items  -->
        <div id="divItems" class="itemDiv">
        </div>

      </div>


      <!-- photos -->
      <div id="divImages" class="myDiv" style="text-align:center;background-color:green ">
        <div class="myDiv" style="display:inline-flex;width:90%">
          <button type="button" id="updateButton" class="btn btn-dark  " style="width:20%;margin:10px"
            onclick="showAllItems();">Refresh</button>
          <!--

          <div style="margin:auto">

            <button class="btn btn-primary dropdown-toggle " type="button" data-bs-toggle="dropdown"
              id="dropdownMenuButton" style="border-radius: 5px;">
              Filter
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.filter='c';">Only Containers</a>
              </li>
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.filter='i';">Only Items</a>
              </li>
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.filter='a';">ShowAll</a>
              </li>
            </ul>

            <button class="btn btn-primary dropdown-toggle " type="button" data-bs-toggle="dropdown"
              id="dropdownMenuButton" style="border-radius: 5px;">
              Sort
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.sort='o';">Old to new</a>
              </li>
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.sort='n';">New to Old</a>
              </li>
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.sort='a';">A to Z</a>
              </li>
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.sort='a';">Z to A</a>
              </li>
            </ul>

            <button class="btn btn-primary dropdown-toggle " type="button" data-bs-toggle="dropdown"
              id="dropdownMenuButton" style="border-radius: 5px;">
              View
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.view='g';">Grid</a>
              </li>
              <li><a class="dropdown-item" href="#" onClick="gShowOptions.view='l';">List</a>
              </li>
            </ul>

          </div>
        -->



        </div>
        <button id="gridBreadcrumbs" style="width:80%;border-radius: 10px;margin:5px;">hover over image</button>
        <div id="divPhotos" class="myDiv"
          style="text-align:center;background-color: aquamarine; margin:0 auto; padding:0px;height:500px;overflow-y: scroll">
        </div>
      </div>

    </div> <!--end second column -->

    <!-- third column -->
    <div id="divDetails" class="myDiv col3">


      <!-- the photo stuff-->
      <div class=" myDiv" style="background-color: rgb(34, 143, 119);text-align:center;padding:5px ">
        <!--  The Photo Upload etc-->
        <div style="margin-top: 30px">
          <img id="thePhoto" style="width:100%;height:100%;border:solid">
        </div>
        <script>function doTest() {

            thePhoto.src = forceImageLoad(thePhoto.src);

          }</script>
        <div>
          <div style="display:none">
            <input style="position:absolute;left:0px;margin-bottom:10px;" type="file" name="file" id="file"
              onchange='btn_uploadImageFile.click()'>
          </div>
          <input type="button" id="btn_uploadImageFile" value="Upload" style="display:none"
            onclick="uploadImageFile();">
          <button id="xxx" onclick="doTest()" style="display: none;">xxx</button>

          <button class="btn-light" onclick="file.click()">UPLOAD PHOTO</button>
        </div>
      </div>

      <!-- the Details update button -->
      <div class="myDiv" style="background-color: blueviolet;text-align:center;padding:5px">
        <p style="color:yellow">Change Item Details</p>
        <button type="button" id="updateButton" class="btn btn-default btn-primary"
          onclick="updateItemFromForm();">Update</button>
        <button type="button" class="btn btn-default btn-primary" onclick="deleteItem();">Delete</button>
      </div>

      <!-- The form -->
      <div style="background-color:white;margin:auto; padding:2px; ">
        <div style="text-align:left;background-color: cornsilk;margin-left: 10px;">
          <form>
            <!--    Form   -->
            <div class="form-group">
              <label for="inName">Name:</label>
              <input type="text" class="form-control" id="inName">
            </div>

            <div class="form-group">
              <label for="inDescription">Description</label>
              <textarea class="form-control" id="inDescription" rows="5"></textarea>
            </div>

            <div class="form-group">
              <label for="inItemId">Item Id</label>
              <input type="text" class="form-control" readonly="true" id="inItemId">
            </div>
            <div class="form-group">
              <label for="inParentId">Parent Id</label>
              <input type="text" class="form-control" readonly="true" id="inParentId">
              <p></p>
            </div>

            <!-- Change parent -->
            <div class="form-group">
              <label for="newParent">Change container:</label>
              <select id="newParent" onChange="updateButton.click">
              </select>
            </div>

            <p></p>
            <p></p>

        </div>
      </div>
    </div>
  </div>

  <!--   STARTS HERE -->

  <script src="./startup.js"></script>

</body>

</html>

<script>

  /*

    OLD tree stuff

  let arrTree = [];
  
          function test() {
  
            let level = -1;
            treeItem = {
              id: "0",
              level: "0",
              name: "home"
  
            };
  
  
  
            function findKids(obj) {
              let kids = [];
              for (let i = 0; i < gItemArray.length; i++) {
                if (gItemArray[i].parentId == obj.id) {
                  kids.push(gItemArray[i]);
                }
              }
              return kids;
            }
  
  
            function makeTree(thisItemObject) {
              level++;
  
              let x = Object.create(treeItem);
  
              x.id = thisItemObject.id;
              x.level = level;
              x.name = thisItemObject.name;
              arrTree.push(x);
  
              //   Utils.doDebug(level);
              //    Utils.doDebug(thisItemObject.id);
              //    Utils.doDebug(thisItemObject.name);
  
  
  
              let obj = thisItemObject;
              let kids = findKids(obj);
              let l = kids.length;
  
              for (let i = 0; i < kids.length; i++) {
                //    Utils.doDebug(kids[i].name);
                makeTree(kids[i]);
              }
              level--;
  
            }
  
            let thisItemObject = gItemArray[0];
            //   Utils.doDebug(thisItemObject.name);
            makeTree(thisItemObject);
            //     debugger;
  
            for (let j = 0; j < arrTree.length; j++) {
              let id = arrTree[j].id;
              let myItem = getItemObjectById(id);
              createTreeButton(myItem, arrTree[j].level);
            }
          }
  
  */

</script>